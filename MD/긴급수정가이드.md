# ğŸ”§ Switch Manga API - ê¸´ê¸‰ ìˆ˜ì • ê°€ì´ë“œ

## ğŸ“‹ ë°œê²¬ëœ ë¬¸ì œ

### 1ï¸âƒ£ Flutter ì—ëŸ¬
```
The method 'getMySeriesDetail' isn't defined for the type 'PublisherPortalService'.
```

### 2ï¸âƒ£ ì´ë¯¸ì§€ í‘œì‹œ ë¬¸ì œ
- Series ìƒì„¸ ì¡°íšŒ ì‹œ coverImageê°€ nullì´ê±°ë‚˜ í‘œì‹œë˜ì§€ ì•ŠìŒ

---

## âœ… í•´ê²° ë°©ë²•

### Step 1: PublisherPortalService.java ìˆ˜ì •

**íŒŒì¼ ìœ„ì¹˜:**
```
D:\Again_E-Book\switch-manga-api\switch-manga-api\src\main\java\com\switchmanga\api\service\PublisherPortalService.java
```

**ì¶”ê°€í•  ì½”ë“œ:** (í´ë˜ìŠ¤ ì•ˆì— ì¶”ê°€)

```java
/**
 * ë‚´ ì‹œë¦¬ì¦ˆ ìƒì„¸ ì¡°íšŒ
 * GET /api/v1/publishers/me/series/{id}
 */
public SeriesDetailResponse getMySeriesDetail(Long seriesId) {
    User currentUser = getCurrentUser();
    Publisher publisher = getPublisherFromUser(currentUser);
    
    Series series = seriesRepository.findById(seriesId)
            .orElseThrow(() -> new RuntimeException("ì‹œë¦¬ì¦ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ID: " + seriesId));
    
    // ê¶Œí•œ ê²€ì¦
    validateSeriesOwnership(currentUser, series);
    
    return SeriesDetailResponse.from(series);
}

/**
 * ì‹œë¦¬ì¦ˆ ì†Œìœ ê¶Œ ê²€ì¦
 */
private void validateSeriesOwnership(User user, Series series) {
    Publisher publisher = getPublisherFromUser(user);

    if (!series.getPublisher().getId().equals(publisher.getId())) {
        throw new RuntimeException("í•´ë‹¹ ì‹œë¦¬ì¦ˆì— ì ‘ê·¼í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
    }
}

/**
 * Userì—ì„œ Publisher ê°€ì ¸ì˜¤ê¸°
 */
private Publisher getPublisherFromUser(User user) {
    // ADMINì´ë©´ ì²« ë²ˆì§¸ Publisher ë°˜í™˜
    if (user.getRole() == UserRole.ADMIN) {
        return publisherRepository.findAll().stream()
                .findFirst()
                .orElseThrow(() -> new RuntimeException("ì¶œíŒì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤."));
    }
    
    // ì„ì‹œ: ì²« ë²ˆì§¸ Publisher ë°˜í™˜
    return publisherRepository.findAll().stream()
            .findFirst()
            .orElseThrow(() -> new RuntimeException("ì¶œíŒì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤."));
}
```

---

### Step 2: PublisherPortalController.java ìˆ˜ì •

**íŒŒì¼ ìœ„ì¹˜:**
```
D:\Again_E-Book\switch-manga-api\switch-manga-api\src\main\java\com\switchmanga\api\controller\PublisherPortalController.java
```

**ì¶”ê°€í•  ì½”ë“œ:** (Controller í´ë˜ìŠ¤ ì•ˆì— ì¶”ê°€)

```java
/**
 * ë‚´ ì‹œë¦¬ì¦ˆ ìƒì„¸ ì¡°íšŒ
 * GET /api/v1/publishers/me/series/{id}
 */
@GetMapping("/me/series/{id}")
public ResponseEntity<ApiResponse<SeriesDetailResponse>> getMySeriesDetail(
        @PathVariable("id") Long seriesId) {
    try {
        SeriesDetailResponse response = publisherPortalService.getMySeriesDetail(seriesId);
        return ResponseEntity.ok(ApiResponse.success(response));
    } catch (RuntimeException e) {
        return ResponseEntity.status(HttpStatus.FORBIDDEN)
                .body(ApiResponse.error(e.getMessage()));
    }
}
```

---

### Step 3: Series Entity í™•ì¸

**íŒŒì¼ ìœ„ì¹˜:**
```
D:\Again_E-Book\switch-manga-api\switch-manga-api\src\main\java\com\switchmanga\api\entity\Series.java
```

**í™•ì¸í•  í•„ë“œ:**
```java
@Column(name = "cover_image", length = 255)
private String coverImage;  // âœ… ì´ í•„ë“œê°€ ìˆëŠ”ì§€ í™•ì¸!
```

**ì—†ìœ¼ë©´ ì¶”ê°€:**
```java
@Column(name = "cover_image", length = 255)
private String coverImage;

// Getter, Setterë„ ì¶”ê°€
public String getCoverImage() {
    return coverImage;
}

public void setCoverImage(String coverImage) {
    this.coverImage = coverImage;
}
```

---

### Step 4: SeriesDetailResponse DTO í™•ì¸

**íŒŒì¼ ìœ„ì¹˜:**
```
D:\Again_E-Book\switch-manga-api\switch-manga-api\src\main\java\com\switchmanga\api\dto\series\SeriesDetailResponse.java
```

**í™•ì¸í•  í•„ë“œ:**
```java
private String coverImage;  // âœ… ì´ í•„ë“œê°€ ìˆëŠ”ì§€ í™•ì¸!
```

**from() ë©”ì„œë“œì—ì„œ coverImage ë§¤í•‘ í™•ì¸:**
```java
public static SeriesDetailResponse from(Series series) {
    return SeriesDetailResponse.builder()
            .id(series.getId())
            .title(series.getTitle())
            .coverImage(series.getCoverImage())  // âœ… ì´ ë¼ì¸ì´ ìˆëŠ”ì§€ í™•ì¸!
            // ... ë‹¤ë¥¸ í•„ë“œë“¤
            .build();
}
```

---

### Step 5: í•„ìˆ˜ Import í™•ì¸

**PublisherPortalService.javaì— í•„ìš”í•œ import:**
```java
import com.switchmanga.api.entity.User;
import com.switchmanga.api.entity.Publisher;
import com.switchmanga.api.entity.Series;
import com.switchmanga.api.dto.series.SeriesDetailResponse;
import com.switchmanga.api.repository.SeriesRepository;
import com.switchmanga.api.repository.PublisherRepository;
```

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

### 1ë‹¨ê³„: ë¹Œë“œ í…ŒìŠ¤íŠ¸
```bash
cd D:\Again_E-Book\switch-manga-api\switch-manga-api
./gradlew clean build
```

### 2ë‹¨ê³„: ì„œë²„ ì‹¤í–‰
```bash
./gradlew bootRun
```

### 3ë‹¨ê³„: API í…ŒìŠ¤íŠ¸

**Postmanì—ì„œ:**

1ï¸âƒ£ **ë¡œê·¸ì¸**
```
POST http://localhost:8081/api/v1/auth/login
Body:
{
  "email": "admin@switchmanga.com",
  "password": "test1234"
}
```

2ï¸âƒ£ **ì‹œë¦¬ì¦ˆ ìƒì„¸ ì¡°íšŒ** (ìƒˆë¡œ ì¶”ê°€ëœ API)
```
GET http://localhost:8081/api/v1/publishers/me/series/1
Headers:
  Authorization: Bearer <í† í°>
```

**ì˜ˆìƒ ì‘ë‹µ:**
```json
{
  "success": true,
  "data": {
    "id": 1,
    "title": "Spider-Man",
    "author": "Stan Lee",
    "coverImage": "https://example.com/covers/spiderman.jpg",  // âœ… ì´ë¯¸ì§€ URL
    "description": "...",
    "status": "ONGOING",
    "publisherId": 1,
    "publisherName": "Marvel Comics"
  }
}
```

---

## ğŸ¯ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Backend ìˆ˜ì •
- [ ] PublisherPortalServiceì— getMySeriesDetail() ì¶”ê°€
- [ ] PublisherPortalControllerì— ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
- [ ] Series Entityì— coverImage í•„ë“œ í™•ì¸
- [ ] SeriesDetailResponseì— coverImage í•„ë“œ í™•ì¸
- [ ] ë¹Œë“œ ì„±ê³µ í™•ì¸
- [ ] ì„œë²„ ì‹¤í–‰ í™•ì¸

### API í…ŒìŠ¤íŠ¸
- [ ] ë¡œê·¸ì¸ ì„±ê³µ
- [ ] GET /api/v1/publishers/me/series/{id} í˜¸ì¶œ
- [ ] coverImage ê°’ì´ nullì´ ì•„ë‹Œì§€ í™•ì¸
- [ ] 401/403 ì—ëŸ¬ ì—†ì´ ì •ìƒ ì‘ë‹µ í™•ì¸

### Flutter ìˆ˜ì • (í•„ìš”ì‹œ)
- [ ] PublisherPortalService.getMySeriesDetail() í˜¸ì¶œ í™•ì¸
- [ ] ì´ë¯¸ì§€ URLì„ Image.network()ë¡œ í‘œì‹œ
- [ ] ì—ëŸ¬ í•¸ë“¤ë§ ì¶”ê°€

---

## ğŸš¨ ì˜ˆìƒ ì—ëŸ¬ ë° í•´ê²°

### ì—ëŸ¬ 1: SeriesDetailResponseë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ
```
cannot find symbol class SeriesDetailResponse
```
**í•´ê²°:** dto/series í´ë”ì— SeriesDetailResponse.java íŒŒì¼ í™•ì¸

### ì—ëŸ¬ 2: getCurrentUser() ë©”ì„œë“œ ì—†ìŒ
```
cannot find symbol method getCurrentUser()
```
**í•´ê²°:** PublisherPortalServiceì— getCurrentUser() ë©”ì„œë“œ êµ¬í˜„ í•„ìš”
```java
private User getCurrentUser() {
    Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
    
    if (authentication == null || !authentication.isAuthenticated()) {
        throw new AccessDeniedException("User is not authenticated");
    }

    String email = authentication.getName();
    
    return userRepository.findByEmail(email)
            .orElseThrow(() -> new AccessDeniedException("User not found"));
}
```

### ì—ëŸ¬ 3: UserRoleì„ ì°¾ì„ ìˆ˜ ì—†ìŒ
```
cannot find symbol class UserRole
```
**í•´ê²°:** User Entityì— role í•„ë“œ ë° enum í™•ì¸

---

## ğŸ“ ì´ë¯¸ì§€ í‘œì‹œ ì•ˆë˜ëŠ” ê²½ìš°

### Flutterì—ì„œ ì´ë¯¸ì§€ í‘œì‹œ:
```dart
// SeriesDetailScreen.dart
Widget _buildCoverImage(String? coverImageUrl) {
  if (coverImageUrl == null || coverImageUrl.isEmpty) {
    return Container(
      height: 200,
      color: Colors.grey[300],
      child: Icon(Icons.image_not_supported, size: 50),
    );
  }
  
  return Image.network(
    coverImageUrl,
    height: 200,
    width: double.infinity,
    fit: BoxFit.cover,
    errorBuilder: (context, error, stackTrace) {
      return Container(
        height: 200,
        color: Colors.grey[300],
        child: Icon(Icons.broken_image, size: 50),
      );
    },
  );
}
```

### ì‚¬ìš©:
```dart
_buildCoverImage(series['coverImage'])
```

---

**ìƒì„±ì¼**: 2025-11-12  
**í”„ë¡œì íŠ¸**: Switch Manga API  
**ìƒíƒœ**: ğŸ”§ ê¸´ê¸‰ ìˆ˜ì • í•„ìš”
