# Switch Manga API ê°œë°œ ì‘ì—… ë¡œê·¸
ì‘ì—… ê¸°ê°„: 2025-10-25

## ğŸ¯ ì‘ì—… ëª©í‘œ
- Spring Boot API ì„œë²„ ì¬ì‹œì‘ ë° ì—ëŸ¬ ìˆ˜ì •
- Entity í•„ë“œ ëˆ„ë½ ë¬¸ì œ í•´ê²°
- Spring Security 403 ì—ëŸ¬ í•´ê²°

---

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. Entity í•„ë“œ ì¶”ê°€

#### Volume.java ìˆ˜ì •
**íŒŒì¼:** `src/main/java/com/switchmanga/api/entity/Volume.java`

**ì¶”ê°€ëœ í•„ë“œ:**
```java
// ì¡°íšŒìˆ˜
@Column(name = "view_count", columnDefinition = "BIGINT DEFAULT 0")
private Long viewCount = 0L;

// í‰ê·  í‰ì 
@Column(name = "average_rating", columnDefinition = "DECIMAL(3,2) DEFAULT 0.0")
private Double averageRating = 0.0;
```

**ì´ìœ :** VolumeRepositoryì—ì„œ ì‚¬ìš©í•˜ëŠ” í•„ë“œê°€ Entityì— ì—†ì–´ì„œ ëŸ°íƒ€ì„ ì—ëŸ¬ ë°œìƒ

---

#### Series.java ìˆ˜ì •
**íŒŒì¼:** `src/main/java/com/switchmanga/api/entity/Series.java`

**ì¶”ê°€ëœ í•„ë“œ:**
```java
// ì¹´í…Œê³ ë¦¬ ID
@Column(name = "category_id")
private Long categoryId;

// ì¡°íšŒìˆ˜
@Column(name = "view_count", columnDefinition = "BIGINT DEFAULT 0")
private Long viewCount = 0L;

// í‰ê·  í‰ì 
@Column(name = "average_rating", columnDefinition = "DECIMAL(3,2) DEFAULT 0.0")
private Double averageRating = 0.0;

// ë¦¬ë·° ê°œìˆ˜
@Column(name = "review_count", columnDefinition = "INT DEFAULT 0")
private Integer reviewCount = 0;
```

**ì´ìœ :** SeriesRepositoryì—ì„œ ì‚¬ìš©í•˜ëŠ” í•„ë“œê°€ Entityì— ì—†ì–´ì„œ ëŸ°íƒ€ì„ ì—ëŸ¬ ë°œìƒ

---

### 2. Repository ë©”ì„œë“œ ìˆ˜ì •

#### VolumeRepository.java ìˆ˜ì •
**íŒŒì¼:** `src/main/java/com/switchmanga/api/repository/VolumeRepository.java`

**ë³€ê²½ ë‚´ìš©:**
```java
// âŒ ê¸°ì¡´ (ì—ëŸ¬)
@Query("SELECT v FROM Volume v WHERE v.publishDate >= :date ...")
List<Volume> findByPublishDateAfter(@Param("date") java.time.LocalDate date);

// âœ… ìˆ˜ì • (ì •ìƒ)
@Query("SELECT v FROM Volume v WHERE v.publicationDate >= :date ...")
List<Volume> findByPublicationDateAfter(@Param("date") LocalDateTime date);
```

**ì´ìœ :** 
- Volume Entityì˜ í•„ë“œëª…ì€ `publicationDate`ì¸ë° ì¿¼ë¦¬ì—ì„œ `publishDate` ì‚¬ìš©
- íƒ€ì…ë„ `LocalDate` â†’ `LocalDateTime`ìœ¼ë¡œ ë³€ê²½

---

### 3. JWT í•„í„° ìˆ˜ì •

#### JwtAuthenticationFilter.java ìˆ˜ì •
**íŒŒì¼:** `src/main/java/com/switchmanga/api/security/JwtAuthenticationFilter.java`

**ì¶”ê°€ëœ ì½”ë“œ:**
```java
// í•„í„°ë¥¼ ê±´ë„ˆë›¸ ê²½ë¡œ ëª©ë¡
private static final List<String> EXCLUDED_PATHS = List.of(
    "/api/v1/auth/",
    "/swagger-ui/",
    "/v3/api-docs/",
    "/api/v1/publishers",
    "/api/v1/series",
    "/api/v1/volumes"
);

@Override
protected boolean shouldNotFilter(HttpServletRequest request) {
    String path = request.getRequestURI();
    return EXCLUDED_PATHS.stream().anyMatch(path::startsWith);
}
```

**ì´ìœ :** Public APIë“¤ì´ JWT í•„í„°ë¥¼ ê±°ì¹˜ì§€ ì•Šë„ë¡ ì„¤ì •

---

### 4. Security ì„¤ì • ìˆ˜ì •

#### SecurityConfig.java ìˆ˜ì •
**íŒŒì¼:** `src/main/java/com/switchmanga/api/config/SecurityConfig.java`

**ë³€ê²½ ë‚´ìš©:**
```java
// âŒ ê¸°ì¡´ (í•˜ìœ„ ê²½ë¡œë§Œ í—ˆìš©)
.requestMatchers("/api/v1/publishers/**").permitAll()

// âœ… ìˆ˜ì • (ì •í™•í•œ ê²½ë¡œì™€ í•˜ìœ„ ê²½ë¡œ ëª¨ë‘ í—ˆìš©)
.requestMatchers("/api/v1/publishers", "/api/v1/publishers/**").permitAll()
.requestMatchers("/api/v1/series", "/api/v1/series/**").permitAll()
.requestMatchers("/api/v1/volumes", "/api/v1/volumes/**").permitAll()
```

**ì´ìœ :** `/api/v1/publishers/**`ëŠ” `/api/v1/publishers/1`ë§Œ ë§¤ì¹­ë˜ê³ , `/api/v1/publishers`ëŠ” ë§¤ì¹­ ì•ˆ ë¨

---

### 5. ì„œë²„ ì‹¤í–‰ ì„±ê³µ

**ê²°ê³¼:**
```bash
Started SwitchMangaApiApplication in 9.598 seconds (process running for 10.397)
```

**í™˜ê²½:**
- GCP ì„œë²„: 34.64.84.117
- í¬íŠ¸: 8080
- í”„ë¡œí•„: local

**í™•ì¸ëœ ì‚¬í•­:**
- âœ… ì„œë²„ ì •ìƒ ì‹œì‘
- âœ… Swagger UI ì ‘ê·¼ ì„±ê³µ (200 OK)
- âŒ Publishers API 403 ì—ëŸ¬ (ë¯¸í•´ê²°)

---

## ğŸ”¥ í˜„ì¬ ì´ìŠˆ

### 403 Forbidden ì—ëŸ¬

**ì¦ìƒ:**
```bash
curl http://localhost:8080/api/v1/publishers
HTTP/1.1 403 Forbidden
```

**í™•ì¸ëœ ì‚¬ì‹¤:**
1. âœ… Swagger UIëŠ” 200 OK â†’ shouldNotFilter ì‘ë™ ì¤‘
2. âœ… SecurityConfig ì½”ë“œëŠ” ì •í™•í•¨
3. âœ… JwtAuthenticationFilter ì½”ë“œë„ ì •í™•í•¨
4. âŒ Publishers APIë§Œ 403 ë°œìƒ

**ê°€ëŠ¥í•œ ì›ì¸:**
1. Spring Security í•„í„° ìˆœì„œ ë¬¸ì œ
2. RequestMatcher ê²½ë¡œ ë§¤ì¹­ ì‹¤íŒ¨
3. ë‹¤ë¥¸ Security ì„¤ì •ê³¼ ì¶©ëŒ
4. ë¡œê·¸ ë ˆë²¨ ë‚®ì•„ì„œ ì •í™•í•œ ì›ì¸ íŒŒì•… ë¶ˆê°€

---

## ğŸ¯ ë‹¤ìŒ ì‘ì—… ê³„íš (2025-10-25 19:00)

### 1ë‹¨ê³„: 403 ì—ëŸ¬ í•´ê²°
```yaml
# application.ymlì— ë¡œê·¸ ì¶”ê°€
logging:
  level:
    org.springframework.security: TRACE
    com.switchmanga.api.security: DEBUG
```

**ë°©ë²•:**
1. ë¡œê·¸ ë ˆë²¨ ì˜¬ë¦¬ê¸°
2. ì •í™•í•œ ì°¨ë‹¨ ì§€ì  íŒŒì•…
3. SecurityConfig ë˜ëŠ” í•„í„° ìˆ˜ì •

---

### 2ë‹¨ê³„: API í…ŒìŠ¤íŠ¸
```bash
# Publishers API
curl http://localhost:8080/api/v1/publishers

# Series API
curl http://localhost:8080/api/v1/series

# Volumes API
curl http://localhost:8080/api/v1/volumes
```

---

### 3ë‹¨ê³„: ìƒ˜í”Œ ë°ì´í„° ì„í¬íŠ¸
```bash
# íŒŒì¼ ìœ„ì¹˜: /mnt/project/sample_data_manga.sql
mysql -u root -p switch_manga < sample_data_manga.sql
```

---

### 4ë‹¨ê³„: ìƒ˜í”Œ ë°ì´í„°ë¡œ API ì¬í…ŒìŠ¤íŠ¸
- Publishers ëª©ë¡ ì¡°íšŒ (ë°ì´í„° ìˆì–´ì•¼ í•¨)
- Series ëª©ë¡ ì¡°íšŒ
- Volumes ëª©ë¡ ì¡°íšŒ

---

### 5ë‹¨ê³„: ë¡œê·¸ì¸ ì‹œìŠ¤í…œ êµ¬ì¶•
**êµ¬í˜„ í•­ëª©:**
1. POST /api/v1/auth/login
2. POST /api/v1/auth/register
3. JWT í† í° ë°œê¸‰ ë¡œì§
4. JWT í† í° ê²€ì¦ ë¡œì§

---

### 6ë‹¨ê³„: Publisher Portal ì—°ë™
- ë¡œê·¸ì¸ ê¸°ëŠ¥ ì—°ê²°
- Dashboard ë°ì´í„° ì—°ë™
- ë§¤ì¶œ/ì£¼ë¬¸ í†µê³„ API ì—°ê²°

---

## ğŸ“ ê´€ë ¨ íŒŒì¼ ëª©ë¡

### Entity
- `/src/main/java/com/switchmanga/api/entity/Volume.java`
- `/src/main/java/com/switchmanga/api/entity/Series.java`

### Repository
- `/src/main/java/com/switchmanga/api/repository/VolumeRepository.java`
- `/src/main/java/com/switchmanga/api/repository/SeriesRepository.java`

### Security
- `/src/main/java/com/switchmanga/api/security/JwtAuthenticationFilter.java`
- `/src/main/java/com/switchmanga/api/config/SecurityConfig.java`

### ì„¤ì •
- `/src/main/resources/application.yml`

### ìƒ˜í”Œ ë°ì´í„°
- `/mnt/project/sample_data_manga.sql`

---

## ğŸ›  ê°œë°œ í™˜ê²½

### ì„œë²„
- **IP:** 34.64.84.117
- **í¬íŠ¸:** 8080
- **OS:** Ubuntu (GCP)
- **DB:** MariaDB 11.8.3

### ë¡œì»¬
- **IDE:** IntelliJ IDEA
- **OS:** Windows
- **í”„ë¡œì íŠ¸ ê²½ë¡œ:** D:\Again_E-Book\switch-manga-api\switch-manga-api

### ê¸°ìˆ  ìŠ¤íƒ
- Spring Boot 3.5.6
- Java 17
- Spring Security 6.5.5
- Hibernate 6.6.29
- MariaDB
- JWT (JSON Web Token)

---

## ğŸ’¡ í•™ìŠµí•œ ë‚´ìš©

### Git Workflow ìµœì í™”
1. âœ… ë¡œì»¬ì—ì„œ ì»´íŒŒì¼ ì„±ê³µ í™•ì¸
2. âœ… Git push
3. âœ… ì„œë²„ì—ì„œ pull
4. âœ… ì„œë²„ ì¬ì‹œì‘

**ì´ìœ :** ì„œë²„ì—ì„œ ì§ì ‘ ìˆ˜ì •í•˜ë©´ sync ì•ˆ ë§ìŒ!

---

### Spring Data JPA ê²€ì¦
- `./gradlew build -x test` â†’ ì»´íŒŒì¼ë§Œ ì²´í¬
- ì‹¤ì œ ì‹¤í–‰ â†’ JPAê°€ ëŸ°íƒ€ì„ì— Repository ë©”ì„œë“œ ê²€ì¦
- **ì»´íŒŒì¼ ì„±ê³µ â‰  ì‹¤í–‰ ì„±ê³µ**

---

### Spring Security 6.x
- `OncePerRequestFilter` â†’ ëª¨ë“  ìš”ì²­ì— ì‹¤í–‰
- `shouldNotFilter()` ì˜¤ë²„ë¼ì´ë“œë¡œ íŠ¹ì • ê²½ë¡œ ì œì™¸
- `requestMatchers()` ê²½ë¡œ ë§¤ì¹­ ì£¼ì˜!
  - `/api/v1/publishers/**` â†’ í•˜ìœ„ ê²½ë¡œë§Œ
  - `/api/v1/publishers` â†’ ì •í™•í•œ ê²½ë¡œë§Œ

---

## ğŸ“ ì½”ë“œ ìŠ¤ë‹ˆí«

### Clean Build & ì¬ì‹œì‘
```bash
cd ~/switch-manga-api
pkill -f switch-manga-api
./gradlew clean build -x test
nohup ./gradlew bootRun > server.log 2>&1 &
tail -f server.log
```

---

### API í…ŒìŠ¤íŠ¸
```bash
# ìƒíƒœ ì½”ë“œ í¬í•¨
curl -w "\nHTTP Status: %{http_code}\n" http://localhost:8080/api/v1/publishers

# ìƒì„¸ í—¤ë” ë³´ê¸°
curl -v http://localhost:8080/api/v1/publishers

# ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸
curl -i http://localhost:8080/api/v1/publishers
```

---

### Git ëª…ë ¹ì–´
```bash
# ìƒíƒœ í™•ì¸
git status

# ì»´íŒŒì¼
./gradlew compileJava

# ì»¤ë°‹ & í‘¸ì‹œ
git add .
git commit -m "ë©”ì‹œì§€"
git push origin main

# ë¡œê·¸ í™•ì¸
git log --oneline -5
```

---

## ğŸ¯ ì¤‘ìš” í¬ì¸íŠ¸

1. **í•­ìƒ ë¡œì»¬ì—ì„œ ë¨¼ì € ë¹Œë“œ í…ŒìŠ¤íŠ¸!**
2. **ì»´íŒŒì¼ ì„±ê³µ â‰  ì‹¤í–‰ ì„±ê³µ (JPA ê²€ì¦)**
3. **Security ì„¤ì •ì€ ë¡œê·¸ ë³´ê³  ë””ë²„ê¹…!**
4. **ìƒ˜í”Œ ë°ì´í„°ëŠ” DBì— ë„£ì–´ì•¼ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥!**
5. **Swagger UIê°€ ë˜ë©´ shouldNotFilterëŠ” ì‘ë™ ì¤‘!**

---

## ğŸ“ ë‹¤ìŒ ì„¸ì…˜ ì‹œì‘í•  ë•Œ

**ì´ ë¬¸ì„œë¥¼ ìƒˆ ëŒ€í™”ì°½ì— ë¶™ì—¬ë„£ìœ¼ë©´:**
- âœ… ì§€ê¸ˆê¹Œì§€ í•œ ì‘ì—… ì „ë¶€ ê³µìœ ë¨
- âœ… í˜„ì¬ ì´ìŠˆ ìƒíƒœ íŒŒì•…ë¨
- âœ… ë‹¤ìŒ í•  ì¼ ëª…í™•í•¨

**ë˜ëŠ” ì´ë ‡ê²Œ ì‹œì‘:**
```
"ì°°ë¦¬ì•¼, ì–´ì œ SecurityConfig 403 ì—ëŸ¬ê¹Œì§€ ì‘ì—…í–ˆëŠ”ë°,
ë¡œê·¸ ë ˆë²¨ ì˜¬ë ¤ì„œ ì›ì¸ ì°¾ê³  í•´ê²°í•˜ì!"
```

---

## â° ë‹¤ìŒ ì„¸ì…˜
**ì¼ì‹œ:** 2025-10-25 19:00
**ì‘ì—…:** SecurityConfig 403 ì—ëŸ¬ í•´ê²°

---

*ë¬¸ì„œ ì‘ì„±: 2025-10-25*
*ì‘ì„±ì: Claude (ì°°ë¦¬)*
